---
name: build-infra-container-builder
run-name: Build container images for CICD infrastructure
on:
  push:
    paths:
      - 'oci/java-builder/**'

jobs:
  oci-build:
    runs-on:
      group: Default
      labels:
        - self-hosted
        - Linux
        - X64
        - eu-central-de
        - labmonkeys
    steps:
      - uses: actions/checkout@v4
      - name: Create Java builder container image
        working-directory: oci/java-builder
        run: |
          make
          make scan
      - name: Persist OCI
        uses: actions/upload-artifact@v4
        with:
          name: java-builder-oci
          path: |
            build/*.oci
      - name: Persist scan results
        uses: actions/upload-artifact@v4
        with:
          name: scan-results
          path: |
            build/cves.html
            build/recommendations.txt
